apiVersion: jenkins.io/v1
kind: Scheduler
metadata:
  creationTimestamp: null
  name: default-scheduler
spec:
  approve:
    issueRequired: false
    lgtmActsAsApprove: true
    requireSelfApproval: true
  merger:
    blockerLabel: ""
    maxGoroutines: 0
    mergeMethod: merge
    policy:
      fromBranchProtection: true
      optionalContexts: {}
      requiredContexts: {}
      requiredIfPresentContexts: {}
      skipUnknownContexts: false
    prStatusBaseUrl: ""
    squashLabel: ""
    targetUrl: http://deck{{ .Values.cluster.namespaceSubDomain }}{{ .Values.cluster.domain }}
  plugins:
    entries:
    - approve
    - assign
    - blunderbuss
    - help
    - hold
    - lgtm
    - lifecycle
    - override
    - size
    - trigger
    - wip
    - heart
    - cat
    - dog
    - pony
    - override
  policy:
    protectTested: true
  postsubmits:
    entries:
    - agent: tekton
      branches:
        entries:
        - master
      cluster: ""
      context: ""
      labels: {}
      maxConcurrency: 0
      name: release
      report: false
      runIfChanged: ""
      skipBranches: {}
  presubmits:
    entries:
    - agent: tekton
      alwaysRun: true
      branches: {}
      cluster: ""
      context: pr-build
      labels: {}
      maxConcurrency: 0
      mergeMethod: ""
      name: pr-build
      optional: false
      policy:
        Replace: false
        requiredStatusChecks:
          contexts:
            entries:
            - pr-build
      queries:
      - excludedBranches: {}
        includedBranches: {}
        labels:
          entries:
          - approved
        milestone: ""
        missingLabels:
          entries:
          - do-not-merge
          - do-not-merge/hold
          - do-not-merge/work-in-progress
          - needs-ok-to-test
          - needs-rebase
        reviewApprovedRequired: false
      - excludedBranches: {}
        includedBranches: {}
        labels:
          entries:
          - updatebot
        milestone: ""
        missingLabels:
          entries:
          - do-not-merge
          - do-not-merge/hold
          - do-not-merge/work-in-progress
          - needs-ok-to-test
          - needs-rebase
        reviewApprovedRequired: false
      report: true
      rerunCommand: /test this
      runIfChanged: ""
      skipBranches: {}
      trigger: (?m)^/test( all| this),?(\s+|$)
  schedulerAgent:
    agent: tekton
  trigger:
    ignoreOkToTest: false
    joinOrgUrl: ""
    onlyOrgMembers: false
    trustedOrg: {{ .Values.gitops.owner }}
  periodics:
    entries:
    - name: periodic-jx-stale
      cron: ""
      interval: 1h
      spec:
        containers:
        - image: gcr.io/k8s-prow/commenter:v20190528-0d7c4b53a
          command:
          - /app/robots/commenter/app.binary
          args:
          - |-
            --query=org:jenkins-x
            -label:lifecycle/frozen
            -label:lifecycle/stale
            -label:lifecycle/rotten
          - --updated=2160h
          - --token=/etc/token/oauth
          - |-
            --comment=Issues go stale after 90d of inactivity.
            Mark the issue as fresh with `/remove-lifecycle stale`.
            Stale issues rot after an additional 30d of inactivity and eventually close.
            If this issue is safe to close now please do so with `/close`.
            Provide feedback via https://jenkins-x.io/community.
            /lifecycle stale
          - --template
          - --ceiling=30
          - --confirm
          volumeMounts:
          - name: token
            mountPath: /etc/token
        volumes:
        - name: token
          secret:
            secretName: oauth-token
    - name: periodic-jx-close
      cron: ""
      interval: 1h
      spec:
        containers:
        - image: gcr.io/k8s-prow/commenter:v20190528-0d7c4b53a
          command:
          - /app/robots/commenter/app.binary
          args:
          - |-
            --query=org:jenkins-x
            -label:lifecycle/frozen
            label:lifecycle/rotten
          - --updated=720h
          - --token=/etc/token/oauth
          - |-
            --comment=Rotten issues close after 30d of inactivity.
            Reopen the issue with `/reopen`.
            Mark the issue as fresh with `/remove-lifecycle rotten`.
            Provide feedback via https://jenkins-x.io/community.
            /close
          - --template
          - --ceiling=10
          - --confirm
          volumeMounts:
          - name: token
            mountPath: /etc/token
        volumes:
        - name: token
          secret:
            secretName: oauth-token
    - name: periodic-jx-rotten
      cron: ""
      interval: 1h
      spec:
        containers:
        - image: gcr.io/k8s-prow/commenter:v20190528-0d7c4b53a
          command:
          - /app/robots/commenter/app.binary
          args:
          - |-
            --query=org:jenkins-x
            -label:lifecycle/frozen
            label:lifecycle/stale
            -label:lifecycle/rotten
          - --updated=720h
          - --token=/etc/token/oauth
          - |-
            --comment=Stale issues rot after 30d of inactivity.
            Mark the issue as fresh with `/remove-lifecycle rotten`.
            Rotten issues close after an additional 30d of inactivity.
            If this issue is safe to close now please do so with `/close`.
            Provide feedback via https://jenkins-x.io/community.
            /lifecycle rotten
          - --template
          - --ceiling=10
          - --confirm
          volumeMounts:
          - name: token
            mountPath: /etc/token
        volumes:
        - name: token
          secret:
            secretName: oauth-token
  welcome:
  - message_template: Welcome
  attachments:
  - name: jobURLPrefix
    urls:
    - 'https://dashboard-jx.jenkins-x.live/teams'
  - name: reportTemplate
    urls:
    - '{{`{{if eq .Spec.Type "presubmit"}}[View all Builds for this Pull Request](https://dashboard-jx.jenkins-x.live/teams/{{.Spec.Namespace}}/projects/{{.Spec.Refs.Org}}/{{.Spec.Refs.Repo}}/PR-{{(index .Spec.Refs.Pulls 1).Number}}) {{else if eq .Spec.Type "batch"}} Run "jx get build log --owner {{.Spec.Refs.Org}} --repo {{.Spec.Refs.Repo}} --branch batch" whilst connected to the cluster. UI support coming soon. {{end}}`}}' 
  - name: jobURLTemplate
    urls:
    - '{{`{{if eq .Spec.Type "presubmit"}}https://dashboard-jx.jenkins-x.live/teams/{{.Spec.Namespace}}/projects/{{.Spec.Refs.Org}}/{{.Spec.Refs.Repo}}/PR-{{(index .Spec.Refs.Pulls 0).Number}}/{{.Status.BuildID}}{{else if eq .Spec.Type "postsubmit"}}https://dashboard-jx.jenkins-x.live/teams/{{.Spec.Namespace}}/projects/{{.Spec.Refs.Org}}/{{.Spec.Refs.Repo}}/{{.Spec.Refs.BaseRef}}/{{.Status.BuildID}}{{end}}`}}'
